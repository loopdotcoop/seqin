<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8">
    <title>Seqin Demo 1: Basic Sine Wave</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Audio sequencer for Looptopia by Loop.Coop">

    <script src="js/seqin.es6.js"></script>

    <style type="text/css">
      .button {
        cursor: pointer;
        float: left;
        transition: color 0.5s;
      }
      .button:hover {
        color: blue;
      }
    </style>

  </head>
  <body style="font-family:Arial, sans-serif; background:#ccc; color:#333">

    <h1><a href="./index.html">Seqin Demo</a></h1>
    <h2>Seqin Demo 1: Basic Sine Wave</h2>

    <pre id="output"></pre>
    <pre><a onclick="DEMO.play()" class="button">
    .--------.
    | play() |
    '========'
    </a></pre>
    <pre><a onclick="DEMO.stop()" class="button">
    .--------.
    | stop() |
    '========'
    </a></pre>
    <pre><a onclick="DEMO.seek(0)" class="button">
    .---------.
    | seek(0) |
    '========='
    </a></pre>
    <pre><a onclick="addExampleNote()" class="button">
    .------------------.
    | Add Example Note |
    '=================='
    </a></pre>

    <script>!function () { 'use strict'

        //// Create a sequin instance.
        const demo1 = window.DEMO = new Seqin({
            tracks:   2    // number of audio channels (default 2)
          , steps:    16   // defines the grid (default 16)
          , fidelity: 5400 // samples per step (default 5400)
        })

        //// Listen for events.
        const $output = document.getElementById('output')
        demo1.on( '*', (event) => { $output.innerHTML = demo1.dump() } )

        //// Jump to a step in the sequence.
        demo1.seek(2)

        //// Schedule some notes.
        const noteId_0 = demo1.addNote({
            track:    0    // id of the track which the note should be added to
          , on:       6    // id of the step at which the 'piano key' is pressed
          , duration: 4    // number of steps until the 'piano key' is released
          , pitch:    'B'  // frequency of voice, eg 'A' or 'C'
          , velocity: 50   // loudness of voice, from 0 to 99
          , voice: {
                release: 8 // number of steps after finger releases piano key
              , fillBuffer: basicSine
            }
        })

        window.addExampleNote = function () {
            const noteId_1 = demo1.addNote({
                track:    1
              , on:       10
              , duration: 2
              , pitch:    'D'
              , velocity: 30
              , voice: {
                    release: 4
                  , fillBuffer: basicSine
                }
            })
        }
/*

        const noteId_2 = demo1.addNote({
            track:    1
          , on:       20 // wraps to step 4
          , duration: 0
          , pitch:    'F'
          , velocity: 99
          , voice: {
                release: 1
              , fillBuffer: basicSine
            }
        })
*/

        //// Define a function for generating AudioBuffer data.
        function basicSine (config) {
            const { buffer, adsr, pitch, velocity } = config
               , l = buffer.length
            for (let i=0; i<l; i++)
              buffer[i] = Math.random() - 0.5 // 50% noise
        }

    }()</script>

  </body>
</html>
